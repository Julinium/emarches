
{% load i18n %}
<div class="wait-azrem pb-3 d-none">
    <div class="progress" 
         role="progressbar" aria-valuenow="100" 
         aria-valuemin="0" aria-valuemax="100"
         style="max-height: 0.5rem;">
        <div class="progress-bar progress-bar-striped progress-bar-animated" 
             style="width: 100%">
        </div>
    </div>
</div>

<button onclick="heartToggle()"
        id="{{ tender.chrono }}-fav"
        class="m-1 btn btn-outline-success favorite-toggle
               {% if favorited %}d-none{% endif %}">
    <!-- <span class="small"><i class="bi bi-square small"></i></span> -->
    <span><i class="{{ bicons.favorite }}"></i></span>
    <span class="d-none d-md-inline ms-1">{% trans 'Favorite' %}</span>
</button>
<button onclick="heartToggle('unfav')"
        id="{{ tender.chrono }}-unfav"
        class="m-1 btn btn-outline-success favorite-toggle
               {% if not favorited %}d-none{% endif %}">
    <!-- <span class="small"><i class="bi bi-check-square small"></i></span> -->
    <span><i class="{{ bicons.unfavorite }}"></i></span>
    <span class="d-none d-md-inline ms-1">{% trans 'Unfavorite' %}</span>
</button>

<script>
    const azrems = document.querySelectorAll('.wait-azrem');
    function heartToggle(makas='fav') {
        azrems.forEach(azrem => { azrem.classList.remove('d-none'); });

        if (makas=='fav'){ url = "{% url 'tender_favorite' tender.id %}"
        } else { url = "{% url 'tender_unfavorite' tender.id %}"}
        const xhr = new XMLHttpRequest();
        xhr.open('GET', url, true);
        xhr.setRequestHeader('Accept', 'text/plain');
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    azrems.forEach(azrem => { azrem.classList.add('d-none'); });
                    const fav_indicator = document.getElementById('faved')
                    const buttons = document.querySelectorAll('.favorite-toggle');
                    buttons.forEach(button => { button.classList.toggle('d-none'); });
                    fav_indicator.classList.toggle('d-none');
                }
            }
        };
        xhr.send();
    }
  </script>