{% extends 'base/base.html' %}
{% load i18n static %}
{% load humanize %}
{% load tz %}

{% block title %}
    {% trans "Concurrent details" %}: {{ bidder.name }}
{% endblock title %}

{% block content %}
    <input type="hidden" id="csrf_token" value="{{ csrf_token }}">

        <div>
            <span class="h3 oneline">{{ bidder.name }}</span>
        </div>

    {% include 'bdc/snippets/bdcs/bdc-actions.html' %}

    <div class="my-3" id="bdc-details">

        <div class="row gx-4 gy-0">
            
            {% trans 'Cumulated offers' as key_value %}
            {% include 'base/snippets/ico-key-val.html' with val_value=bidder.bidders_sum key_value=key_value uni_value='' ico_class=bicons.estimte val_class='fw-bold' border='bottom' liner='' %}

            {% trans 'Cumulated won offers' as key_value %}
            {% include 'base/snippets/ico-key-val.html' with val_value=bidder.winner_bids_sum key_value=key_value uni_value='' ico_class=bicons.estimte val_class='fw-bold' border='bottom' liner='' %}
            
            {% if bidder.success_rate %}
                {% trans 'Success rate' as key_value %}
                {% include 'base/snippets/ico-key-val.html' with val_value=bidder.success_rate key_value=key_value uni_value='%' ico_class=bicons.estimte val_class='fw-bold' border='bottom' liner='' %}
            {% endif %}

            {% if bidder.latest_win %}
                {% trans 'Latest win' as key_value %}
                {% include 'base/snippets/ico-key-val.html' with val_value=bidder.latest_win key_value=key_value uni_value='' ico_class=bicons.estimte val_class='fw-bold' border='bottom' liner='' %}
            {% endif %}

            {% if bidder.highest_win %}
                {% trans 'Highest win' as key_value %}
                {% include 'base/snippets/ico-key-val.html' with val_value=bidder.highest_win key_value=key_value uni_value='' ico_class=bicons.estimte val_class='fw-bold' border='bottom' liner='' %}
            {% endif %}
            
            {% if bidder.lowest_win %}
                {% trans 'Lowest win' as key_value %}
                {% include 'base/snippets/ico-key-val.html' with val_value=bidder.lowest_win key_value=key_value uni_value='' ico_class=bicons.estimte val_class='fw-bold' border='bottom' liner='' %}
            {% endif %}
        
        </div>

            <div class="accordion my-3" id="accordionBidders">
                <div class="accordion-item shadow-sm">
                    <h2 class="accordion-header">
                        <button class="accordion-button p-2 collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#biddersCollapse" aria-expanded="true" aria-controls="biddersCollapse">
                            <span><i class="{{ bicons.articles }}"></i></span>
                            <span class="fw-bold ms-1">{{ bidder.bidders.all|length }}</span>
                            <span class="ms-2 fw-light">{% trans "Participations" %}</span>
                        </button>
                    </h2>
                    <div id="biddersCollapse" class="accordion-collapse collapse" data-bs-parent="#accordionBidders">
                        <div class="accordion-body p-0">
                            <div class="list-group">
                                {% for bid in bidder.bidders.all %}
                                    <a class="list-group-item list-group-item-action" target="_blank" 
                                       href="{% url 'portal_tender_detail' bid.minutes.tender.id %}">
                                        <div>
                                            <span class="fw-bold small">{{ bid.minutes.date_end }}</span>
                                            <!-- <span class="small fw-light float-end">
                                                <i class="{{ bicons.estimate }}"></i>
                                                {{ bid.minutes.tender.estimate }}
                                            </span> -->
                                        </div>
                                        <div class="">
                                            <span>{{ bid.minutes.tender.title }}</span>
                                        </div>
                                    </a>
                                {% empty %}
                                    <div class="list-group-item">
                                        <div class="fw-light small text-danger my-2">{% trans 'None' %}</div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div> 
                    </div> 
                </div>
            </div>


            <div class="accordion my-3" id="accordionAdminRejects">
                <div class="accordion-item shadow-sm">
                    <h2 class="accordion-header">
                        <button class="accordion-button p-2 collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#adminRejectsCollapse" aria-expanded="true" aria-controls="adminRejectsCollapse">
                            <span><i class="bi bi-x-octagon me-1"></i></span>
                            <span class="fw-bold ms-1 
                                        {% if bidder.admin_rejects.all|length > 0 %}
                                            text-danger
                                        {% endif %}
                                        ">
                                {{ bidder.admin_rejects.all|length }}
                            </span>
                            <span class="ms-2 fw-light">{% trans "Admin Rejects" %}</span>
                        </button>
                    </h2>
                    <div id="adminRejectsCollapse" class="accordion-collapse collapse" data-bs-parent="#accordionAdminRejects">
                        <div class="accordion-body p-0">
                            <div class="list-group">
                                {% for admin_reject in bidder.admin_rejects.all %}
                                    <a class="list-group-item list-group-item-action" target="_blank" 
                                        href="{% url 'portal_tender_detail' admin_reject.minutes.tender.id %}">
                                        {% ifchanged admin_reject.minutes.tender %}
                                            <div class="fw-light small">{{ admin_reject.minutes.date_end }}</div>
                                            <div class="">{{ admin_reject.minutes.tender.title }}</div>
                                        {% endifchanged %}
                                        <div>
                                            <span class="float-end">
                                                {% if admin_reject.minutes.tender.lots_count > 1 %}
                                                    <span class="fw-light small">Lot {{ admin_reject.lot_number }}</span>
                                                {% endif %}
                                            </span>
                                            
                                        </div>
                                    </a>
                                {% empty %}
                                    <div class="list-group-item">
                                        <div class="fw-light small text-danger my-2">{% trans 'None' %}</div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div> 
                    </div> 
                </div>
            </div>


            <div class="accordion my-3" id="accordionWins">
                <div class="accordion-item shadow-sm">
                    <h2 class="accordion-header">
                        <button class="accordion-button p-2 collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#winsCollapse" aria-expanded="true" aria-controls="winsCollapse">
                            <span><i class="{{ bicons.articles }}"></i></span>
                            <span class="fw-bold ms-1">{{ bidder.winner_bids.all|length }}</span>
                            <span class="ms-2 fw-light">{% trans "Winners" %}</span>
                        </button>
                    </h2>
                    <div id="winsCollapse" class="accordion-collapse collapse" data-bs-parent="#accordionWins">
                        <div class="accordion-body p-0">
                            <div class="list-group">
                                {% for win in bidder.winner_bids.all %}
                                    <a class="list-group-item list-group-item-action" target="_blank" 
                                        href="{% url 'portal_tender_detail' win.minutes.tender.id %}">
                                        {% ifchanged win.minutes.tender %}
                                            <div class="fw-light small">{{ win.minutes.date_end }}</div>
                                            <div class="twolines">{{ win.minutes.tender.title }}</div>
                                        {% endifchanged %}
                                        <div>
                                            <span class="float-end">
                                                {% if win.minutes.tender.lots_count > 1 %}
                                                    <span class="fw-light small">Lot {{ win.lot_number }}:</span>
                                                {% endif %}
                                                <span class="fw-bold ms-2">{{ win.amount }}</span>
                                            </span>
                                            
                                        </div>
                                    </a>
                                {% empty %}
                                    <div class="list-group-item">
                                        <div class="fw-light small text-danger my-2">{% trans 'None' %}</div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div> 
                    </div> 
                </div>
            </div>
        

    </div>

    {% include 'bdc/snippets/bdcs/bdc-actions.html' %}



{% endblock content %}
